@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

@theme inline {
	--color-background: var(--background);
	--color-foreground: var(--foreground);
	--font-sans: var(--font-space-grotesk);
	--font-mono: var(--font-jetbrains-mono);
	--color-card: var(--card);
	--color-card-foreground: var(--card-foreground);
	--color-popover: var(--popover);
	--color-popover-foreground: var(--popover-foreground);
	--color-primary: var(--primary);
	--color-primary-foreground: var(--primary-foreground);
	--color-secondary: var(--secondary);
	--color-secondary-foreground: var(--secondary-foreground);
	--color-muted: var(--muted);
	--color-muted-foreground: var(--muted-foreground);
	--color-accent: var(--accent);
	--color-accent-foreground: var(--accent-foreground);
	--color-destructive: var(--destructive);
	--color-border: var(--border);
	--color-input: var(--input);
	--color-ring: var(--ring);
	--radius-sm: calc(var(--radius) - 4px);
	--radius-md: calc(var(--radius) - 2px);
	--radius-lg: var(--radius);
	--radius-xl: calc(var(--radius) + 4px);
	--radius-2xl: calc(var(--radius) + 8px);
}

:root {
	--radius: 0.75rem;
	--background: oklch(0.14 0.02 260);
	--foreground: oklch(0.96 0.01 260);
	--card: oklch(0.18 0.02 260);
	--card-foreground: oklch(0.96 0.01 260);
	--popover: oklch(0.18 0.02 260);
	--popover-foreground: oklch(0.96 0.01 260);
	--primary: oklch(0.78 0.16 200);
	--primary-foreground: oklch(0.16 0.02 260);
	--secondary: oklch(0.26 0.02 265);
	--secondary-foreground: oklch(0.95 0.01 260);
	--muted: oklch(0.22 0.02 260);
	--muted-foreground: oklch(0.72 0.02 260);
	--accent: oklch(0.3 0.08 320);
	--accent-foreground: oklch(0.98 0.01 260);
	--destructive: oklch(0.62 0.22 25);
	--border: oklch(1 0 0 / 12%);
	--input: oklch(1 0 0 / 14%);
	--ring: oklch(0.7 0.1 210);
	--code-bg: oklch(0.16 0.02 260);
	--code-surface: oklch(0.19 0.02 260);
	--code-border: oklch(1 0 0 / 14%);
	--code-muted: oklch(0.72 0.02 260);
	--code-cursor: oklch(0.78 0.16 200);
	--code-correct: oklch(0.8 0.15 150);
	--code-error: oklch(0.68 0.22 20);
	--code-error-bg: oklch(0.3 0.16 20 / 40%);
	--tab-width: 4;
}

.light {
	--background: oklch(0.98 0.01 260);
	--foreground: oklch(0.2 0.02 260);
	--card: oklch(1 0 0);
	--card-foreground: oklch(0.2 0.02 260);
	--popover: oklch(1 0 0);
	--popover-foreground: oklch(0.2 0.02 260);
	--primary: oklch(0.6 0.18 215);
	--primary-foreground: oklch(0.98 0 0);
	--secondary: oklch(0.94 0.02 260);
	--secondary-foreground: oklch(0.2 0.02 260);
	--muted: oklch(0.94 0.02 260);
	--muted-foreground: oklch(0.55 0.02 260);
	--accent: oklch(0.88 0.06 320);
	--accent-foreground: oklch(0.2 0.02 260);
	--destructive: oklch(0.6 0.22 25);
	--border: oklch(0.82 0.02 260);
	--input: oklch(0.88 0.02 260);
	--ring: oklch(0.6 0.12 210);
	--code-bg: oklch(0.97 0.01 260);
	--code-surface: oklch(0.92 0.02 260);
	--code-border: oklch(0.82 0.02 260);
	--code-muted: oklch(0.5 0.02 260);
	--code-cursor: oklch(0.6 0.18 215);
	--code-correct: oklch(0.55 0.16 150);
	--code-error: oklch(0.55 0.22 25);
	--code-error-bg: oklch(0.78 0.16 25 / 35%);
}

@layer base {
	* {
		@apply border-border outline-ring/50;
	}
	body {
		@apply bg-background text-foreground font-sans antialiased;
	}
}

@layer components {
	.app-shell {
		background: radial-gradient(circle at top left, oklch(0.2 0.1 250 / 45%), transparent 60%);
	}

	.code-panel {
		@apply rounded-2xl border;
		background: var(--code-bg);
		border-color: var(--code-border);
		box-shadow: 0 30px 80px oklch(0 0 0 / 30%);
	}

	.code-header {
		@apply flex items-center gap-2 border-b px-4 py-3 text-xs uppercase tracking-[0.2em];
		border-color: var(--code-border);
		color: var(--code-muted);
	}

	.preview-code {
		font-variant-ligatures: none;
	}
}

@layer utilities {
	.typing-line {
		white-space: pre;
		line-height: 1.7;
	}

	.typing-char {
		position: relative;
		transition: color 120ms ease, background-color 120ms ease;
		font-variant-ligatures: none;
		opacity: 0.45;
		text-decoration: none;
	}

	.typing-char.tab-char,
	.preview-code .tab-char {
		position: relative;
		display: inline-block;
		width: calc(var(--tab-width) * 1ch);
	}

	.typing-char.tab-char::before,
	.preview-code .tab-char::before {
		content: "⇥";
		position: absolute;
		left: 0;
		color: var(--code-muted);
		opacity: 0.6;
		font-size: 0.9em;
	}

	.typing-char.newline-char {
		position: relative;
		display: inline-block;
		width: 1ch;
	}

	.typing-char.newline-char::before {
		content: "↵";
		position: absolute;
		left: 0;
		color: var(--code-muted);
		opacity: 0.6;
		font-size: 0.9em;
	}

	.typing-char.typed {
		text-decoration: none;
		border-bottom: none;
		opacity: 1;
	}

	.typing-char.error {
		background-color: var(--code-error-bg);
		border-bottom: 1px solid var(--code-error);
		color: var(--code-error);
		opacity: 1;
	}

	.typing-char.cursor::after {
		content: "";
		position: absolute;
		left: 0;
		bottom: -0.2em;
		width: 0.9ch;
		height: 2px;
		border-radius: 999px;
		background: var(--code-cursor);
		animation: cursorPulse 1.2s ease-in-out infinite;
	}

	.typing-char.cursor {
		opacity: 1;
	}

	.typing-input {
		caret-color: transparent !important;
	}

	@keyframes cursorPulse {
		0%,
		100% {
			opacity: 0.2;
		}
		50% {
			opacity: 1;
		}
	}
}
